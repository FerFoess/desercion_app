{% extends "base.html" %}
{% block title %}Predicci√≥n de Abandono Escolar{% endblock %}

{% block content %}
<div class="container mt-4 mb-5">
  <h1 class="text-center mb-4">üìä Predicci√≥n de Abandono Escolar</h1>

  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <div class="alert alert-success">
        {% for message in messages %}
          <div>{{ message }}</div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <form action="{{ url_for('main.procesar') }}" method="post" enctype="multipart/form-data" class="card shadow p-4">

    <div class="mb-3">
      <label class="form-label"><strong>Sube tu archivo CSV:</strong></label>
      <input type="file" name="archivo_csv" class="form-control" required>
    </div>

    <h4 class="mb-3">Selecciona las variables por categor√≠a:</h4>

    <div class="accordion" id="variablesAccordion">

      <!-- Datos acad√©micos -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingAcademicos">
          <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAcademicos" aria-expanded="true">
            üßë‚Äçüéì Datos acad√©micos
          </button>
        </h2>
        <div id="collapseAcademicos" class="accordion-collapse collapse show">
          <div class="accordion-body">
            {% set academicos = [
              ('promedio', 'Promedio'),
              ('reprobo_materia', 'Reprob√≥ materia'),
              ('materias_reprobadas', 'N¬∫ de materias reprobadas'),
              ('motivacion', 'Motivaci√≥n'),
              ('asistencia', 'Asistencia'),
              ('dificultad_materias', 'Dificultades acad√©micas'),
              ('horas_estudio', 'Horas de estudio')
            ] %}
            {% for var, label in academicos %}
              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="variables" value="{{ var }}">
                <label class="form-check-label">{{ label }}</label>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>

      <!-- Datos personales y emocionales -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingPersonales">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePersonales">
            üí¨ Datos personales y emocionales
          </button>
        </h2>
        <div id="collapsePersonales" class="accordion-collapse collapse">
          <div class="accordion-body">
            {% set personales = [
              ('estres', 'Estr√©s'),
              ('condicion_medica', 'Condici√≥n m√©dica')
            ] %}
            {% for var, label in personales %}
              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="variables" value="{{ var }}">
                <label class="form-check-label">{{ label }}</label>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>

      <!-- Entorno familiar -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingFamiliar">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFamiliar">
            üè† Entorno Familiar
          </button>
        </h2>
        <div id="collapseFamiliar" class="accordion-collapse collapse">
          <div class="accordion-body">
            {% set familiar = [
              ('vive_con_tutores', 'Vive con tutores'),
              ('apoyo_familiar', 'Apoyo familiar'),
              ('conflictos_casa', 'Conflictos en casa')
            ] %}
            {% for var, label in familiar %}
              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="variables" value="{{ var }}">
                <label class="form-check-label">{{ label }}</label>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>

      <!-- Situaci√≥n econ√≥mica -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingEconomica">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEconomica">
            üí∏ Situaci√≥n econ√≥mica y laboral
          </button>
        </h2>
        <div id="collapseEconomica" class="accordion-collapse collapse">
          <div class="accordion-body">
            {% set economica = [
              ('trabaja', 'Tiene empleo'),
              ('trabaja_apoyo', 'Apoya econ√≥micamente'),
              ('economia_dificulta', 'Econom√≠a limita estudios'),
              ('acceso_recursos', 'Acceso a recursos')
            ] %}
            {% for var, label in economica %}
              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="variables" value="{{ var }}">
                <label class="form-check-label">{{ label }}</label>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>

      <!-- Aspiraciones -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingAspiraciones">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAspiraciones">
            üéØ Aspiraciones y apoyo escolar
          </button>
        </h2>
        <div id="collapseAspiraciones" class="accordion-collapse collapse">
          <div class="accordion-body">
            {% set aspiraciones = [
              ('interes_terminar', 'Inter√©s por terminar'),
              ('orientacion', 'Recibe orientaci√≥n'),
              ('conoce_apoyos', 'Conoce becas/apoyos')
            ] %}
            {% for var, label in aspiraciones %}
              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="variables" value="{{ var }}">
                <label class="form-check-label">{{ label }}</label>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>

      <!-- Otros -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingOtros">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOtros">
            üÜî Otros
          </button>
        </h2>
        <div id="collapseOtros" class="accordion-collapse collapse">
          <div class="accordion-body">
            {% set otros = [
              ('edad', 'Edad'),
              ('sexo', 'Sexo')
            ] %}
            {% for var, label in otros %}
              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="variables" value="{{ var }}">
                <label class="form-check-label">{{ label }}</label>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>

    <div class="mt-4 text-center">
      <button type="submit" class="btn btn-primary btn-lg">Procesar Clusterizaci√≥n</button>
    </div>
  </form>
</div>
{% endblock %}
